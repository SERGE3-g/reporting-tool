<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Contatti - Tool di Reporting Commissioni</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Font Awesome per icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- CSS principale -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/admin.css">

</head>
<body>
<!-- Importa la navbar -->
<div id="navbar-placeholder"></div>

<div class="app-container">
    <div class="contact-container">
        <div class="contact-header">
            <h1><i class="fas fa-envelope"></i> Contattaci</h1>
            <p>Per qualsiasi richiesta di assistenza, informazione o collaborazione, non esitare a contattarci. Il
                nostro team è a tua disposizione.</p>
        </div>

        <div class="contact-sections">
            <div class="contact-card">
                <h3><i class="fas fa-headset"></i> Supporto Tecnico</h3>
                <p>Il nostro team di supporto tecnico è disponibile per risolvere qualsiasi problema o domanda
                    sull'utilizzo dell'applicazione.</p>
                <ul>
                    <li><i class="fas fa-envelope"></i> <a href="mailto:gueaserge2@gmail.com" class="contact-link">gueaserge2@gmail.com</a>
                    </li>
                    <li><i class="fas fa-phone"></i> <a href="tel:+393892978507" class="contact-link">+39 3892978507</a>
                    </li>
                    <li><i class="fas fa-clock"></i> Lun-Ven: 9:00-18:00</li>
                </ul>
            </div>

            <div class="contact-card">
                <h3><i class="fas fa-briefcase"></i> Informazioni Commerciali</h3>
                <p>Per informazioni su licenze, prezzi o per richiedere una demo personalizzata della nostra
                    applicazione.</p>
                <ul>
                    <li><i class="fas fa-envelope"></i> <a href="mailto:gueaserge2@gmail.com" class="contact-link">gueaserge2@gmail.com</a>
                    </li>
                    <li><i class="fas fa-phone"></i> <a href="tel:+393892978507" class="contact-link">+39 3892978507</a>
                    </li>
                    <li><i class="fas fa-clock"></i> Lun-Ven: 9:00-18:00</li>
                </ul>
            </div>

            <div class="contact-card">
                <h3><i class="fas fa-map-marker-alt"></i> Sede</h3>
                <p>La nostra sede principale è situata a Formia, facilmente raggiungibile con i mezzi
                    pubblici.</p>
                <ul>
                    <li><i class="fas fa-building"></i> Serge Guea</li>
                    <li><i class="fas fa-map-pin"></i> Via Virgilio 19, 04023</li>
                    <li><i class="fas fa-city"></i> Formia (LT), Italia</li>
                </ul>
            </div>
        </div>

        <div class="contact-form-container">
            <h2>Inviaci un messaggio</h2>
            <form class="contact-form" id="contactForm">
                <div class="form-group">
                    <label for="name">Nome *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="phone">Telefono</label>
                    <input type="tel" id="phone" name="phone">
                </div>

                <div class="form-group">
                    <label for="subject">Oggetto *</label>
                    <select id="subject" name="subject" required>
                        <option value="">Seleziona un'opzione</option>
                        <option value="support">Supporto Tecnico</option>
                        <option value="info">Informazioni Generali</option>
                        <option value="sales">Informazioni Commerciali</option>
                        <option value="feedback">Feedback</option>
                        <option value="other">Altro</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label for="message">Messaggio *</label>
                    <textarea id="message" name="message" required></textarea>
                </div>

                <div class="form-note">
                    <small>* Campi obbligatori</small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Invia Messaggio
                    </button>
                </div>
            </form>
            <div id="formStatus" class="form-status" style="display: none;"></div>
        </div>

        <div class="map-container">
            <div id="map"
                 style="height: 400px; width: 100%; border-radius: var(--border-radius); box-shadow: var(--box-shadow);"></div>
        </div>

        <div style="text-align: center; margin-bottom: 30px;">
            <h3 style="color: var(--primary); margin-bottom: 15px;">Seguici sui Social</h3>
            <div class="social-links">
                <a href="https://www.facebook.com/share/1XwjNnZ9Bt/?mibextid=wwXIfr" class="social-link"><i
                        class="fab fa-facebook-f"></i></a>
                <a href="https://x.com/sergeguea" class="social-link"><i class="fab fa-twitter"></i></a>
                <a href="https://www.linkedin.com/in/sergeguea/" class="social-link"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.instagram.com/sergio_guea" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="https://youtube.com/@sergeguea" class="social-link"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
    </div>
</div>

<!-- Importa il footer -->
<div id="footer-placeholder"></div>

<!-- Script -->
<script src="js/common.js"></script>
<script>
    // Carica navbar e footer
    document.addEventListener('DOMContentLoaded', function () {
        loadComponent('components/navbar.html', 'navbar-placeholder');
        loadComponent('components/footer.html', 'footer-placeholder');

        // Inizializza la pagina
        initContactPage();
    });

    function initContactPage() {
        // Inizializza il form di contatto
        const contactForm = document.getElementById('contactForm');
        const formStatus = document.getElementById('formStatus');

        contactForm.addEventListener('submit', function (e) {
            e.preventDefault();

            // Mostra lo stato di invio
            formStatus.innerHTML = '<div class="sending-message"><i class="fas fa-spinner fa-spin"></i> Invio in corso...</div>';
            formStatus.style.display = 'block';

            // Raccolta dati dal form
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value || 'Non specificato',
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value
            };

            // Converti l'oggetto subject in testo leggibile
            const subjectMap = {
                'support': 'Supporto Tecnico',
                'info': 'Informazioni Generali',
                'sales': 'Informazioni Commerciali',
                'feedback': 'Feedback',
                'other': 'Altro'
            };

            // Ottieni il testo leggibile per il soggetto
            const subjectText = subjectMap[formData.subject] || formData.subject;

            // Crea il corpo dell'email utilizzando i dati del form
            const emailBody = {
                to: 'gueaserge2@gmail.com', // La tua email
                from: formData.email,
                replyTo: formData.email,
                subject: `Richiesta di contatto: ${subjectText}`,
                html: `
                        <h2>Nuovo messaggio dal modulo di contatto</h2>
                        <p><strong>Nome:</strong> ${formData.name}</p>
                        <p><strong>Email:</strong> ${formData.email}</p>
                        <p><strong>Telefono:</strong> ${formData.phone}</p>
                        <p><strong>Oggetto:</strong> ${subjectText}</p>
                        <h3>Messaggio:</h3>
                        <p>${formData.message.replace(/\n/g, '<br>')}</p>
                        <hr>
                        <p><small>Questo messaggio è stato inviato dal modulo di contatto sul sito Tool di Reporting Commissioni.</small></p>
                    `
            };

            // Invia al server utilizzando l'API electronAPI in un contesto Electron
            // In un'app web, useresti fetch o XMLHttpRequest
            if (window.reportingTool && window.reportingTool.sendEmail) {
                window.reportingTool.sendEmail(emailBody)
                    .then(response => {
                        handleEmailResponse(response);
                    })
                    .catch(error => {
                        handleEmailError(error);
                    });
            } else {
                // Alternativa per ambiente web: invio tramite API REST
                fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(emailBody)
                })
                    .then(response => response.json())
                    .then(data => {
                        handleEmailResponse(data);
                    })
                    .catch(error => {
                        handleEmailError(error);
                    });
            }
        });

        function handleEmailResponse(response) {
            if (response.success) {
                formStatus.innerHTML = '<div class="success-message"><i class="fas fa-check-circle"></i> Grazie per averci contattato. Ti risponderemo il prima possibile!</div>';
                contactForm.reset();
            } else {
                formStatus.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> Siamo spiacenti, si è verificato un errore durante l'invio. Per favore riprova o contattaci direttamente all'indirizzo email: gueaserge2@gmail.com</div>`;
            }

            // Nascondi il messaggio dopo 10 secondi
            setTimeout(() => {
                formStatus.style.display = 'none';
            }, 10000);
        }

        function handleEmailError(error) {
            console.error('Errore nell\'invio dell\'email:', error);
            formStatus.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> Siamo spiacenti, si è verificato un errore durante l'invio. Per favore riprova o contattaci direttamente all'indirizzo email: gueaserge2@gmail.com</div>`;

            // Nascondi il messaggio dopo 10 secondi
            setTimeout(() => {
                formStatus.style.display = 'none';
            }, 10000);
        }

        // Inizializza la mappa
        initMap();
    }

    function initMap() {
        // Coordinate di Formia (sede dell'azienda)
        const lat = 41.2560;
        const lng = 13.6122;

        // Inizializza la mappa
        const map = L.map('map').setView([lat, lng], 15);

        // Aggiungi layer di base da OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // Aggiungi marker per la sede dell'azienda
        const marker = L.marker([lat, lng]).addTo(map);

        // Aggiungi un popup con le informazioni dell'azienda
        marker.bindPopup(`
                <strong>Serge Guea</strong><br>
                Via Virgilio 19, 04023<br>
                Formia (LT), Italia<br>
                <a href="tel:+393892978507">+39 3892978507</a>
            `).openPopup();

        // Aggiungi controlli per lo zoom
        L.control.zoom({
            position: 'bottomright'
        }).addTo(map);

        // Gestisci ridimensionamento della finestra
        window.addEventListener('resize', function () {
            map.invalidateSize();
        });

        console.log('Mappa inizializzata con successo');
    }
</script>

<!-- Aggiunta dello stile per i messaggi di stato del form -->
<style>
    .form-status {
        margin-top: 15px;
        padding: 12px;
        border-radius: var(--border-radius);
    }

    .sending-message {
        background-color: #e2f0fb;
        color: #0c5fad;
        padding: 10px 15px;
        border-left: 4px solid #0c5fad;
    }

    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 10px 15px;
        border-left: 4px solid #155724;
    }

    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px 15px;
        border-left: 4px solid #721c24;
    }

    .sending-message i, .success-message i, .error-message i {
        margin-right: 8px;
    }
</style>
</body>
</html>